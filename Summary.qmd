---
format: 
  pdf:
    papersize: letter
    page-layout: full
    margin-left: 1.5cm
    margin-right: 1.5cm
    margin-top: 1.5cm
    margin-bottom: 1.5cm
    mainfont: ArialMT
params:
    target: 141100000
    comparator: 261100000
    outcome: 3
header-includes:
  - \pagestyle{empty}
  - \usepackage{xcolor} 
  - \definecolor{ohdsiblue}{HTML}{336B91}
---

```{r echo=FALSE,message=FALSE,warning=FALSE}
library(knitr)
library(kableExtra)

source("GetConnectionDetails.R")
source("PlotsAndTableFunctions.R")
connection <- connect(connectionDetails)
```

\noindent
  \makebox[\textwidth][c]{
    \textbf{LEGEND-T2DM Evidence Dissemination Summary}
  }


```{r echo=FALSE, output="asis"}
writeLines(createHeader(params$target, params$comparator, params$outcome, connection))
```

\noindent
\colorbox{ohdsiblue}{
  \makebox[\textwidth][l]{
    \textcolor{white}{\textbf{How Often?} (Incidence rates in the PS-matched target cohorts)}
  }
}

```{r echo=FALSE}
table <- createHowOftenTable(params$target, params$comparator, params$outcome, connection)
kable(table, format = "latex", booktabs = TRUE, linesep = "", escape = TRUE, align = c("l", "r", "r", "r", "r"), longtable = FALSE) %>%
  kable_styling(latex_options = c("hold_position", "striped", "scale_down"), font_size=11) %>%
  column_spec(1, width = "4cm", latex_valign = "m") %>%
  column_spec(2, width = "4cm", latex_valign = "m") %>%
  column_spec(3, width = "4cm", latex_valign = "m") %>%
  column_spec(4, width = "4cm", latex_valign = "m") %>%
  column_spec(5, width = "4cm", latex_valign = "m") 
```

\noindent
\colorbox{ohdsiblue}{
  \makebox[\textwidth][l]{
    \textcolor{white}{\textbf{How Reliable Are the Effect Estimates?}  (Objective diagnostics)}
  }
}
```{r echo=FALSE,fig.width=8.5,fig.height=5,warning=FALSE}
grid::grid.draw(createDiagnosticsTable(params$target, params$comparator, params$outcome, connection))
```
\noindent
\colorbox{ohdsiblue}{
  \makebox[\textwidth][l]{
    \textcolor{white}{\textbf{What have we learned from the OHDSI Network?}  (Meta-analysis diagnostics and estimate)}
  }
}
```{r echo=FALSE,fig.width=8.5,fig.height=1.5,warning=FALSE}
grid::grid.draw(createMetaAnalysisTable(params$target, params$comparator, params$outcome, connection))
```

```{r echo=FALSE,message=FALSE,warning=FALSE}
disconnect(connection)
```

